Если в задаче спрашивают <b>матожидание (average) от <u>количества</u> (например, "expected <u>number</u>") объектов, подходящих <u>условию</u></b> (или, например, количество раз, когда произойдёт событие), то **в первую очередь нужно попробовать** решить задачу этим методом.
Главный трюк состоит в том, что вместо того, чтобы искать объекты, подходящие условию, мы посчитаем условие (0 - False, 1 - True) для каждого объекта, и сложим эти числа.
```haskell
countIf :: (a -> Bool) -> [a] -> Int
countIf1 predicate = length . filter predicate
countIf2 predicate = sum . map (\x -> if predicate x then 1 else 0)
-- list.filter(p).length() == list.map(p).sum()
```
### Алгоритм
1. Разложить искомую случайную величину на сумму индикаторов. Пусть $n$ - это общее количество объектов, которые надо проверить.
   $\xi=\#\text{объектов под условием}=\xi_1+\xi_2+...+\xi_n$, где $\xi_i=I(\text{i-ый объект подходит условию})$
2. Дальше всё просто. $E\xi=E(\xi_1+...+\xi_n)=E\xi_1+...E\xi_n=n\cdot P(\text{i-ый объект подходит})$
3. Найти вероятность индикатора. Так как в вероятности упоминается только один объект, то состояние остальных не важно, даже если они зависимые. Часто удобно считать вероятность через [[Комбинаторная вероятность|комбинаторику]].
4. **Если** объекты (и индикаторы) **независимые**, то $Var(\xi)=Var(\xi_1+...+\xi_n)=Var(\xi_1)+...+Var(\xi_n)=npq$ (да, при независимых переменных, это биномиальное распределение).
   Иначе, $Var(\xi)=E\xi^2-(E\xi)^2$. Надо найти $E\xi^2=E(\xi_1+...+\xi_n)^2$. [[Суммы|Раскрываем квадрат суммы]], [[Индикаторы|упрощаем кси квадрат]] ($\xi_i^2=\xi_i$) и [[Индикаторы|понимаем]], что 
   $$\xi_i\xi_j=I(\text{i-ый объект подходит условию})I(\text{j-ый объект подходит условию})=I(\text{i-ый и j-ый объекты подходят условию})$$
   $$E\xi^2=E(\xi_1^2+...+\xi_n^2+\sum_{i=1}^n\sum_{j=i+1}^n2\xi_i\xi_j)=nP(\text{i-ый объект подходит условию})+\frac{n(n-1)}2P(\text{i-ый и j-ый объекты подходят условию})$$
5. Остаётся аккуратно посчитать вторую вероятность, где речь про два объекта одновременно. Осторожно работать с зависимыми событиями, если есть. Или посчитать комбинаторно. И подставить всё в формулу варианса.
#### Пример (лаба 4, №12)
>*Ten people entered the lift at the ground floor of a nine-storey building. How many stops is the lift going to make as it goes up?*

"How many stops" $\Leftrightarrow$ "Количество этажей с остановкой"
**Перебираемые объекты:** 9 этажей
**Условие выбора:** была остановка
Выполняя алгоритм, ответ будет $9P(\text{остановки на i-ом этаже})$. После того, как мы проанализируем эксперимент на составные части, как описано в [[Комбинаторная вероятность]], понимаем, что элементарный исход - массив 10 чисел от 1 до 9 (выбор каждого человека). Остановка будет, если **хотя бы один** человек нажмёт на этаж $\implies$ идём от противного и находим комбинаторно, что $P=1-\frac{8^{10}}{9^{10}}$.
