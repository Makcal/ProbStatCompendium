Как уже было описано в [[Комбинаторная вероятность]] и [[Поиск источников случайности]], часто эксперимент можно разделить на **последовательность действий** (под-экспериментов). В случае, когда они зависимые, можно решать задачу этим методом.
Каждый мини-эксперимент (последовательное действие) назовём "фазой". Рассмотрим на примере двух фаз, но логика обобщается на большее количество. Пусть у каждой фазы есть результат в виде событий $A$ и $B$, которые обычно являются $\set{\xi=x}$ и $\set{\eta=y}$, где случайные величины некоторым образом **отражают результат** соответствующих фаз.

Вероятно, нас спрашивают $P(B)=P(\eta=y)$ - вопрос про вторую фазу, на который мы не можем ответить, потому что вероятность и распределение $\eta$ зависит от результата первой фазы. Это не проблема, ведь мы можем использовать **формулу полной вероятности**, чтобы рассмотреть каждый исход первой фазы отдельно - если мы зафиксировали исход первой фазы, то посчитать вероятность про вторую будет легко, и **формулу условной вероятности**, чтобы найти вероятность последовательных действий (сначала найдём вероятность желаемого кейса первой фазы, а потом **в контексте** результата первой фазы найдём желаемую вероятность о второй фазе):
$$P(\eta=y)=\sum_xP(\xi=x\ \&\ \eta=y) = \sum_xP(\xi=x)P(\eta=y|\xi=x)$$
Для трёх фаз обобщается так: $P(\xi=x\ \&\ \eta=y\ \&\ \zeta=z) = P(\xi=x)P(\eta=y|\xi=x)P(\zeta=z|\xi=x\ \&\ \eta=y)$.

>[!note]
>Подразумевается, что посчитать условную вероятность будет просто, так как мы представляем, что прошлые фазы больше не случайны и мы просто проводим **обычный однофазный** эксперимент, считая что $\xi$ (результаты предыдущих фаз) это константа со значением $x$.

### Пример (лаба 4, №5)
>A total of $N$ dipopers were manufactured at Lobanov factory in central Choknutistan, with each dipoper having a defect with probability $p$. Each dipoper undergoes a test which detects the defect (if present) with probability $r$. Let $\xi$ be the number of defective dipopers, $\eta$ the number of dipopers that were revealed to have a defect by the test. Assume that each dipoper is defective or not independently of all the others, and that the outcome of each test is also independent of all the other outcomes.

Найдём $p_\eta(y)$. Распределение непонятно, а перебирать все случаи вручную сложно, поэтому решим двухфазным методом. **Первая фаза** - производство дипоперов, выход - $\xi$, количество сломанных. **Вторая фаза** - тест дипоперов, выход - $\eta$, количество обнаруженных дефектов.![[twophase.jpg]]
$$P(\eta=y) = \sum_{x}P(\xi=x\ \&\ \eta=y) = \sum_{x}P(\xi=x)P(\eta=y|\xi=x)$$
$P(\xi=x)=C_N^xp^x(1-p)^{N-x}I(x\in\set{0,...,N})$, так как $\xi$ логически ни от чего не зависит и это обычное биномиальное распределение.
$P(\eta=y|\xi=x)$. Представляем (за счёт условия), что у нас с первой фазы **всегда** выходит ровно $x$ сломанных дипоперов. Они идут на тест. Это опять биномиальное распределение. $P(\eta=y|\xi=x) = C_x^yr^y(1-r)^{x-y}I(y\in\set{0,...,x})$
Объединяем формулу и [[Индикаторы|решаем условие индикаторов]] относительно $x$, чтобы уточнить границы суммы:
$$P(\eta=y) = \sum_{x} C_N^xp^x(1-p)^{N-x}\mathbf{I(x\in\set{0,...,N})} \cdot C_x^yr^y(1-r)^{x-y}I(y\in\set{0,...,x}) =$$
$$= \sum_{x=0}^N C_N^xp^x(1-p)^{N-x}\cdot C_x^yr^y(1-r)^{x-y}\mathbf{I(x \ge y)} =$$
$$= \sum_{x=\max(0,y)}^N C_N^xp^x(1-p)^{N-x}\cdot C_x^yr^y(1-r)^{x-y}\mathbf{I(y \le N)} =$$
$$= I(y\in\set{0,...,N})\sum_{x=y}^N C_N^xp^x(1-p)^{N-x}\cdot C_x^yr^y(1-r)^{x-y}$$
*Представим, что это можно упростить в красивый ответ.*